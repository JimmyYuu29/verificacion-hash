# üîê FORVIS MAZARS - Document Hash Verification System

<p align="center">
  <strong>Sistema de verificaci√≥n de autenticidad de documentos mediante c√≥digos hash</strong><br>
  <em>Document Authenticity Verification System using Hash Codes</em>
</p>

---

## üìã Descripci√≥n / Description

Este sistema permite verificar la autenticidad de documentos PDF generados por FORVIS MAZARS mediante c√≥digos hash √∫nicos. Cada documento contiene un c√≥digo hash en el pie de p√°gina que puede ser verificado a trav√©s de esta aplicaci√≥n web.

*This system verifies the authenticity of PDF documents generated by FORVIS MAZARS using unique hash codes. Each document contains a hash code in the footer that can be verified through this web application.*

### Caracter√≠sticas Principales / Key Features

- ‚úÖ **Verificaci√≥n de Hash Completo** - Formato: `XX-XXXXXXXXXXXX` (ej: `CM-A1B2C3D4E5F6`)
- ‚úÖ **Verificaci√≥n de C√≥digo Corto** - Formato: `XXXXXX` (6 caracteres alfanum√©ricos)
- ‚úÖ **Verificaci√≥n de Integridad** - Compara el hash SHA-256 del PDF subido con el hash almacenado
- ‚úÖ **B√∫squeda Parcial** - Busca documentos con coincidencias parciales del hash
- ‚úÖ **Estad√≠sticas** - Visualiza estad√≠sticas de documentos almacenados
- ‚úÖ **API REST** - API completa documentada con OpenAPI/Swagger
- ‚úÖ **Modo Oscuro/Claro** - Interfaz adaptable con toggle de tema

---

## üè∑Ô∏è Tipos de Documentos / Document Types

| C√≥digo | Tipo de Documento |
|--------|-------------------|
| `CM` | Carta de Manifestaci√≥n |
| `IA` | Informe de Auditor√≠a |
| `CE` | Carta de Encargo |
| `IR` | Informe de Revisi√≥n |
| `OT` | Otros Documentos |

---

## üöÄ Instalaci√≥n y Uso / Installation & Usage

### Requisitos Previos / Prerequisites

- Python 3.11 o superior
- pip (gestor de paquetes de Python)

### Opci√≥n 1: Ejecuci√≥n Local / Local Execution

```bash
# 1. Clonar el repositorio / Clone the repository
git clone https://github.com/your-username/verificacion-hash.git
cd verificacion-hash

# 2. Ejecutar el script de inicio / Run the startup script
chmod +x run.sh
./run.sh
```

El script `run.sh` autom√°ticamente:
- Crea un entorno virtual si no existe
- Instala las dependencias
- Inicia el servidor en `http://localhost:8000`

### Opci√≥n 2: Instalaci√≥n Manual / Manual Installation

```bash
# 1. Crear entorno virtual / Create virtual environment
python3 -m venv venv
source venv/bin/activate  # En Windows: venv\Scripts\activate

# 2. Instalar dependencias / Install dependencies
pip install -r requirements.txt

# 3. Ejecutar la aplicaci√≥n / Run the application
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

### Opci√≥n 3: Docker

```bash
# 1. Construir la imagen / Build the image
docker build -t hash-verifier .

# 2. Ejecutar el contenedor / Run the container
docker run -d -p 8000:8000 -v $(pwd)/output:/app/output hash-verifier
```

---

## üì° API Endpoints

La aplicaci√≥n expone una API REST completa. Accede a la documentaci√≥n interactiva en:
- **Swagger UI**: `http://localhost:8000/docs`
- **ReDoc**: `http://localhost:8000/redoc`

### Endpoints Disponibles / Available Endpoints

| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| `GET` | `/api/verify/{hash_code}` | Verificar un c√≥digo hash o c√≥digo corto |
| `POST` | `/api/verify/integrity` | Verificar integridad del documento PDF |
| `GET` | `/api/search?q={query}` | Buscar documentos por hash parcial |
| `GET` | `/api/stats` | Obtener estad√≠sticas de documentos |
| `GET` | `/api/document-types` | Listar tipos de documentos disponibles |

### Ejemplos de Uso de la API / API Usage Examples

#### Verificar Hash Completo
```bash
curl http://localhost:8000/api/verify/CM-A1B2C3D4E5F6
```

#### Verificar C√≥digo Corto
```bash
curl http://localhost:8000/api/verify/ABCDEF
```

#### Verificar Integridad del Documento
```bash
curl -X POST "http://localhost:8000/api/verify/integrity?hash_code=CM-A1B2C3D4E5F6" \
     -F "file=@documento.pdf"
```

#### Buscar Documentos
```bash
curl "http://localhost:8000/api/search?q=A1B2"
```

#### Obtener Estad√≠sticas
```bash
curl http://localhost:8000/api/stats
```

---

## üìÅ Estructura del Proyecto / Project Structure

```
verificacion-hash/
‚îú‚îÄ‚îÄ main.py                 # Aplicaci√≥n FastAPI principal
‚îú‚îÄ‚îÄ requirements.txt        # Dependencias de Python
‚îú‚îÄ‚îÄ Dockerfile             # Configuraci√≥n de Docker
‚îú‚îÄ‚îÄ run.sh                 # Script de inicio r√°pido
‚îú‚îÄ‚îÄ static/                # Archivos est√°ticos del frontend
‚îÇ   ‚îú‚îÄ‚îÄ index.html         # P√°gina principal
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ styles.css     # Estilos CSS
‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îÇ       ‚îî‚îÄ‚îÄ app.js         # L√≥gica JavaScript del frontend
‚îî‚îÄ‚îÄ output/                # Directorio de metadatos de documentos
    ‚îî‚îÄ‚îÄ {user_id}/         # Carpetas por usuario
        ‚îî‚îÄ‚îÄ metadata_*.json # Archivos de metadatos
```

---

## üóÇÔ∏è Estructura de Metadatos / Metadata Structure

Cada documento verificable tiene un archivo JSON de metadatos con la siguiente estructura:

```json
{
  "version": "1.0",
  "trace_id": "uuid-√∫nico",
  "hash_info": {
    "hash_code": "CM-A1B2C3D4E5F6",
    "short_code": "ABCDEF",
    "algorithm": "SHA-256",
    "content_hash": "sha256-del-contenido-pdf",
    "metadata_hash": "sha256-de-metadatos",
    "combined_hash": "sha256-combinado",
    "file_size": 45678
  },
  "document_info": {
    "type": "carta_manifestacion",
    "type_display": "Carta de Manifestacion",
    "file_name": "nombre_archivo.docx",
    "creation_timestamp": "21/01/2026 14:30:45",
    "creation_timestamp_iso": "2026-01-21T14:30:45.123456"
  },
  "user_info": {
    "user_id": "demo_user",
    "client_name": "Nombre del Cliente"
  },
  "form_data": {
    "Nombre_Cliente": "...",
    "Direccion_Oficina": "...",
    "...": "..."
  }
}
```

---

## üîß Mantenimiento / Maintenance

### Agregar Nuevos Documentos / Adding New Documents

Para agregar un nuevo documento al sistema:

1. **Crear el directorio del usuario** (si no existe):
   ```bash
   mkdir -p output/{user_id}
   ```

2. **Crear el archivo de metadatos**:
   ```bash
   # Nombre del archivo: metadata_{HASH_CODE}_{TRACE_ID}.json
   touch output/{user_id}/metadata_CM-XXXXXXXXXXXX_trace001.json
   ```

3. **Completar el JSON** con la estructura de metadatos mostrada anteriormente.

### Agregar Nuevos Tipos de Documento / Adding New Document Types

Editar el diccionario `DOCUMENT_TYPES` en `main.py`:

```python
DOCUMENT_TYPES = {
    "CM": {"code": "carta_manifestacion", "display": "Carta de Manifestacion"},
    "IA": {"code": "informe_auditoria", "display": "Informe de Auditoria"},
    # Agregar nuevo tipo aqu√≠:
    "XX": {"code": "nuevo_tipo", "display": "Nuevo Tipo de Documento"},
}
```

### Logs y Depuraci√≥n / Logs & Debugging

Para ver logs detallados, ejecuta con el nivel de log configurado:

```bash
uvicorn main:app --host 0.0.0.0 --port 8000 --reload --log-level debug
```

### Backup de Datos / Data Backup

Los datos se almacenan en el directorio `output/`. Para realizar un backup:

```bash
# Crear backup con fecha
tar -czvf backup_output_$(date +%Y%m%d).tar.gz output/
```

---

## üé® Personalizaci√≥n / Customization

### Cambiar Puerto del Servidor / Change Server Port

```bash
# Opci√≥n 1: Variable de entorno
export PORT=3000
uvicorn main:app --host 0.0.0.0 --port $PORT

# Opci√≥n 2: Directamente en el comando
uvicorn main:app --host 0.0.0.0 --port 3000
```

### Modificar Estilos CSS

Edita el archivo `static/css/styles.css` para personalizar:
- Colores del tema claro/oscuro
- Tipograf√≠a
- Layout y espaciado
- Efectos de hover y transiciones

### Cambiar el Logo/Branding

Edita el archivo `static/index.html`:
```html
<header class="header">
    <div class="logo">
        <h1>TU EMPRESA</h1>  <!-- Cambiar nombre -->
        <span class="subtitle">Document Hash Verifier</span>
    </div>
</header>
```

### Agregar Idiomas Adicionales

La interfaz actual es biling√ºe (Espa√±ol/Ingl√©s). Para agregar m√°s idiomas, modifica:
- `static/index.html` - Textos del frontend
- Mensajes de respuesta en `main.py`

### Configurar CORS para Producci√≥n

Por defecto, CORS permite todas las origenes. Para producci√≥n, modifica en `main.py`:

```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["https://tu-dominio.com"],  # Especificar dominios permitidos
    allow_credentials=True,
    allow_methods=["GET", "POST"],
    allow_headers=["*"],
)
```

### Cambiar Directorio de Salida / Change Output Directory

Modifica la constante `OUTPUT_DIR` en `main.py`:

```python
OUTPUT_DIR = Path("/ruta/personalizada/output")
```

### Modificar Formato de Hash

Para cambiar el patr√≥n de validaci√≥n del hash, edita las constantes en `main.py`:

```python
# Hash completo: XX-XXXXXXXXXXXX
HASH_PATTERN = re.compile(r'^[A-Z]{2}-[A-Z0-9]{12}$', re.IGNORECASE)

# C√≥digo corto: 6 caracteres alfanum√©ricos
SHORT_CODE_PATTERN = re.compile(r'^[A-Z0-9]{6}$', re.IGNORECASE)
```

---

## üê≥ Docker en Producci√≥n / Docker in Production

### docker-compose.yml (Recomendado)

```yaml
version: '3.8'
services:
  hash-verifier:
    build: .
    ports:
      - "8000:8000"
    volumes:
      - ./output:/app/output
    restart: unless-stopped
    environment:
      - TZ=Europe/Madrid
```

```bash
docker-compose up -d
```

---

## üì¶ Dependencias / Dependencies

| Paquete | Versi√≥n | Descripci√≥n |
|---------|---------|-------------|
| FastAPI | ‚â•0.109.0 | Framework web moderno y r√°pido |
| Uvicorn | ‚â•0.27.0 | Servidor ASGI de alto rendimiento |
| python-multipart | ‚â•0.0.6 | Soporte para upload de archivos |
| Pydantic | ‚â•2.5.0 | Validaci√≥n de datos |

---

## üîí Seguridad / Security

- Los c√≥digos hash son generados usando SHA-256
- La verificaci√≥n de integridad compara hashes para detectar modificaciones
- Los archivos de metadatos se almacenan localmente (sin base de datos externa)
- Se recomienda configurar HTTPS en producci√≥n mediante proxy reverso (nginx, traefik)

---

## üìû Soporte / Support

Para reportar problemas o solicitar nuevas caracter√≠sticas, crea un issue en el repositorio.

---

## üìÑ Licencia / License

¬© 2026 FORVIS MAZARS - Todos los derechos reservados / All rights reserved

---

<p align="center">
  <strong>Hash Verification System v1.0</strong>
</p>
